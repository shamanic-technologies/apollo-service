{
  "openapi": "3.0.0",
  "info": {
    "title": "Apollo Service",
    "description": "Service for searching and enriching leads via the Apollo API",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:3004"
    }
  ],
  "components": {
    "schemas": {
      "OrgId": {
        "type": "string",
        "description": "Organization ID",
        "example": "550e8400-e29b-41d4-a716-446655440000"
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "service": {
            "type": "string"
          }
        },
        "required": [
          "status",
          "service"
        ]
      },
      "HealthDebugResponse": {
        "type": "object",
        "properties": {
          "keyServiceUrl": {
            "type": "string"
          },
          "dbConfigured": {
            "type": "boolean"
          },
          "dbStatus": {
            "type": "string"
          },
          "keyServiceStatus": {
            "type": "string"
          }
        },
        "required": [
          "keyServiceUrl",
          "dbConfigured",
          "dbStatus",
          "keyServiceStatus"
        ]
      },
      "SearchResponse": {
        "type": "object",
        "properties": {
          "searchId": {
            "type": "string",
            "nullable": true
          },
          "peopleCount": {
            "type": "number"
          },
          "totalEntries": {
            "type": "number"
          },
          "people": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Person"
            }
          },
          "pagination": {
            "$ref": "#/components/schemas/Pagination"
          }
        },
        "required": [
          "searchId",
          "peopleCount",
          "totalEntries",
          "people",
          "pagination"
        ]
      },
      "Person": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "firstName": {
            "type": "string",
            "nullable": true
          },
          "lastName": {
            "type": "string",
            "nullable": true
          },
          "email": {
            "type": "string",
            "nullable": true
          },
          "emailStatus": {
            "type": "string",
            "nullable": true
          },
          "title": {
            "type": "string",
            "nullable": true
          },
          "linkedinUrl": {
            "type": "string",
            "nullable": true
          },
          "photoUrl": {
            "type": "string",
            "nullable": true
          },
          "headline": {
            "type": "string",
            "nullable": true
          },
          "city": {
            "type": "string",
            "nullable": true
          },
          "state": {
            "type": "string",
            "nullable": true
          },
          "country": {
            "type": "string",
            "nullable": true
          },
          "seniority": {
            "type": "string",
            "nullable": true
          },
          "departments": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "subdepartments": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "functions": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "twitterUrl": {
            "type": "string",
            "nullable": true
          },
          "githubUrl": {
            "type": "string",
            "nullable": true
          },
          "facebookUrl": {
            "type": "string",
            "nullable": true
          },
          "employmentHistory": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "organizationName": {
                  "type": "string"
                },
                "startDate": {
                  "type": "string"
                },
                "endDate": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                },
                "current": {
                  "type": "boolean"
                }
              }
            }
          },
          "organizationName": {
            "type": "string",
            "nullable": true
          },
          "organizationDomain": {
            "type": "string",
            "nullable": true
          },
          "organizationIndustry": {
            "type": "string",
            "nullable": true
          },
          "organizationSize": {
            "type": "string",
            "nullable": true
          },
          "organizationRevenueUsd": {
            "type": "string",
            "nullable": true
          },
          "organizationWebsiteUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationLogoUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationShortDescription": {
            "type": "string",
            "nullable": true
          },
          "organizationSeoDescription": {
            "type": "string",
            "nullable": true
          },
          "organizationLinkedinUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationTwitterUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationFacebookUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationBlogUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationCrunchbaseUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationAngellistUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationFoundedYear": {
            "type": "number",
            "nullable": true
          },
          "organizationPrimaryPhone": {
            "type": "string",
            "nullable": true
          },
          "organizationPubliclyTradedSymbol": {
            "type": "string",
            "nullable": true
          },
          "organizationPubliclyTradedExchange": {
            "type": "string",
            "nullable": true
          },
          "organizationAnnualRevenuePrinted": {
            "type": "string",
            "nullable": true
          },
          "organizationTotalFunding": {
            "type": "string",
            "nullable": true
          },
          "organizationTotalFundingPrinted": {
            "type": "string",
            "nullable": true
          },
          "organizationLatestFundingRoundDate": {
            "type": "string",
            "nullable": true
          },
          "organizationLatestFundingStage": {
            "type": "string",
            "nullable": true
          },
          "organizationFundingEvents": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "date": {
                  "type": "string"
                },
                "type": {
                  "type": "string"
                },
                "investors": {
                  "type": "string"
                },
                "amount": {
                  "type": "number"
                },
                "currency": {
                  "type": "string"
                }
              }
            }
          },
          "organizationCity": {
            "type": "string",
            "nullable": true
          },
          "organizationState": {
            "type": "string",
            "nullable": true
          },
          "organizationCountry": {
            "type": "string",
            "nullable": true
          },
          "organizationStreetAddress": {
            "type": "string",
            "nullable": true
          },
          "organizationPostalCode": {
            "type": "string",
            "nullable": true
          },
          "organizationTechnologyNames": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationCurrentTechnologies": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "object",
              "properties": {
                "uid": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "category": {
                  "type": "string"
                }
              }
            }
          },
          "organizationKeywords": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationIndustries": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationSecondaryIndustries": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationNumSuborganizations": {
            "type": "number",
            "nullable": true
          },
          "organizationRetailLocationCount": {
            "type": "number",
            "nullable": true
          },
          "organizationAlexaRanking": {
            "type": "number",
            "nullable": true
          }
        },
        "required": [
          "id",
          "firstName",
          "lastName",
          "email",
          "emailStatus",
          "title",
          "linkedinUrl"
        ]
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": {
            "type": "number"
          },
          "perPage": {
            "type": "number"
          },
          "totalEntries": {
            "type": "number"
          },
          "totalPages": {
            "type": "number"
          }
        },
        "required": [
          "page",
          "perPage",
          "totalEntries",
          "totalPages"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          }
        },
        "required": [
          "error"
        ]
      },
      "SearchRequest": {
        "type": "object",
        "properties": {
          "runId": {
            "type": "string",
            "description": "Runs-service parent run ID. Required — results are stored in DB and costs tracked via runs-service.",
            "example": "run-abc-123"
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          },
          "workflowName": {
            "type": "string",
            "description": "Workflow name for run tracking in runs-service.",
            "example": "fetch-lead"
          },
          "personTitles": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by job titles. Combined with other filters using AND.",
            "example": [
              "CEO",
              "CTO",
              "VP Engineering"
            ]
          },
          "qOrganizationKeywordTags": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by organization keyword tags. Combined with other filters using AND.",
            "example": [
              "SaaS",
              "fintech"
            ]
          },
          "organizationLocations": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by organization HQ location. Combined with other filters using AND.",
            "example": [
              "United States",
              "California, US"
            ]
          },
          "organizationNumEmployeesRanges": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "1,10",
                "11,20",
                "21,50",
                "51,100",
                "101,200",
                "201,500",
                "501,1000",
                "1001,2000",
                "2001,5000",
                "5001,10000",
                "10001,"
              ]
            },
            "description": "Filter by employee count ranges. Combined with other filters using AND.",
            "example": [
              "11,20",
              "21,50",
              "51,100"
            ]
          },
          "qOrganizationIndustryTagIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by industry names (use GET /reference/industries for valid values). Combined with other filters using AND.",
            "example": [
              "Information Technology and Services",
              "Computer Software"
            ]
          },
          "qKeywords": {
            "type": "string",
            "description": "Free-text keyword search across person and organization fields. Combined with other filters using AND. Keep broad to avoid empty results.",
            "example": "machine learning"
          },
          "personLocations": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by person's location (city, state, country). Different from organizationLocations which filters by company HQ. Combined with other filters using AND.",
            "example": [
              "San Francisco, California, US",
              "New York, US"
            ]
          },
          "personSeniorities": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "entry",
                "senior",
                "manager",
                "director",
                "vp",
                "c_suite",
                "owner",
                "founder",
                "partner"
              ]
            },
            "description": "Filter by seniority level. Valid values: entry, senior, manager, director, vp, c_suite, owner, founder, partner. Combined with other filters using AND.",
            "example": [
              "director",
              "vp",
              "c_suite"
            ]
          },
          "contactEmailStatus": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "verified",
                "guessed",
                "unavailable",
                "bounced",
                "pending_manual_fulfillment"
              ]
            },
            "description": "Filter by email verification status. Valid values: verified, guessed, unavailable, bounced, pending_manual_fulfillment. Combined with other filters using AND.",
            "example": [
              "verified"
            ]
          },
          "qOrganizationDomains": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by specific company domains. Combined with other filters using AND.",
            "example": [
              "google.com",
              "meta.com"
            ]
          },
          "currentlyUsingAnyOfTechnologyUids": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by technology stack (Apollo technology UIDs). Combined with other filters using AND.",
            "example": [
              "salesforce",
              "hubspot"
            ]
          },
          "revenueRange": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by annual revenue ranges (comma-separated min,max format, similar to employee ranges). Combined with other filters using AND.",
            "example": [
              "1000000,10000000",
              "10000000,50000000"
            ]
          },
          "organizationIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by specific Apollo organization IDs. Combined with other filters using AND.",
            "example": [
              "5f5e100a01d6b1000169c754"
            ]
          },
          "page": {
            "type": "integer",
            "minimum": 1,
            "maximum": 500
          },
          "perPage": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100
          }
        },
        "required": [
          "runId",
          "appId",
          "brandId",
          "campaignId"
        ],
        "description": "All search filters are combined using AND. Using too many filters simultaneously may return 0 results — start broad and narrow down."
      },
      "SearchNextResponse": {
        "type": "object",
        "properties": {
          "people": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Person"
            },
            "description": "People returned for this page. Empty array when done=true."
          },
          "done": {
            "type": "boolean",
            "description": "True when all pages have been exhausted. No more results to fetch."
          },
          "totalEntries": {
            "type": "number",
            "description": "Total number of people matching the search filters across all pages."
          }
        },
        "required": [
          "people",
          "done",
          "totalEntries"
        ],
        "description": "One page of search results with pagination state."
      },
      "SearchNextRequest": {
        "type": "object",
        "properties": {
          "campaignId": {
            "type": "string",
            "description": "Campaign ID — used as the pagination cursor key. One cursor per (orgId, campaignId).",
            "example": "campaign-abc-123"
          },
          "brandId": {
            "type": "string",
            "description": "Brand ID.",
            "example": "brand-1"
          },
          "appId": {
            "type": "string",
            "description": "App ID.",
            "example": "my-app"
          },
          "searchParams": {
            "$ref": "#/components/schemas/SearchFilters"
          },
          "runId": {
            "type": "string",
            "description": "Runs-service parent run ID. Required — a search audit record is stored and 1 apollo-search-credit is tracked.",
            "example": "run-abc-123"
          },
          "workflowName": {
            "type": "string",
            "description": "Workflow name for run tracking in runs-service.",
            "example": "fetch-lead"
          }
        },
        "required": [
          "campaignId",
          "brandId",
          "appId",
          "runId"
        ],
        "description": "Request body for server-managed search pagination. The cursor is keyed by (orgId, campaignId)."
      },
      "SearchFilters": {
        "type": "object",
        "properties": {
          "personTitles": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by job titles.",
            "example": [
              "CEO",
              "CTO",
              "VP Engineering"
            ]
          },
          "qOrganizationKeywordTags": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by organization keyword tags.",
            "example": [
              "SaaS",
              "fintech"
            ]
          },
          "organizationLocations": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by organization HQ location.",
            "example": [
              "United States",
              "California, US"
            ]
          },
          "organizationNumEmployeesRanges": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "1,10",
                "11,20",
                "21,50",
                "51,100",
                "101,200",
                "201,500",
                "501,1000",
                "1001,2000",
                "2001,5000",
                "5001,10000",
                "10001,"
              ]
            },
            "description": "Filter by employee count ranges.",
            "example": [
              "11,20",
              "21,50",
              "51,100"
            ]
          },
          "qOrganizationIndustryTagIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by industry names (use GET /reference/industries for valid values).",
            "example": [
              "Information Technology and Services",
              "Computer Software"
            ]
          },
          "qKeywords": {
            "type": "string",
            "description": "Free-text keyword search across person and organization fields.",
            "example": "machine learning"
          },
          "personLocations": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by person's location (city, state, country). Different from organizationLocations which filters by company HQ.",
            "example": [
              "San Francisco, California, US",
              "New York, US"
            ]
          },
          "personSeniorities": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "entry",
                "senior",
                "manager",
                "director",
                "vp",
                "c_suite",
                "owner",
                "founder",
                "partner"
              ]
            },
            "description": "Filter by seniority level. Valid values: entry, senior, manager, director, vp, c_suite, owner, founder, partner.",
            "example": [
              "director",
              "vp",
              "c_suite"
            ]
          },
          "contactEmailStatus": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "verified",
                "guessed",
                "unavailable",
                "bounced",
                "pending_manual_fulfillment"
              ]
            },
            "description": "Filter by email verification status. Valid values: verified, guessed, unavailable, bounced, pending_manual_fulfillment.",
            "example": [
              "verified"
            ]
          },
          "qOrganizationDomains": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by specific company domains.",
            "example": [
              "google.com",
              "meta.com"
            ]
          },
          "currentlyUsingAnyOfTechnologyUids": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by technology stack (Apollo technology UIDs).",
            "example": [
              "salesforce",
              "hubspot"
            ]
          },
          "revenueRange": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by annual revenue ranges (comma-separated min,max format).",
            "example": [
              "1000000,10000000",
              "10000000,50000000"
            ]
          },
          "organizationIds": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Filter by specific Apollo organization IDs.",
            "example": [
              "5f5e100a01d6b1000169c754"
            ]
          }
        },
        "description": "Search filters. On first call, provide filters to create a cursor at page 1. On subsequent calls, omit to continue from the last page. If provided and different from the stored filters, the cursor resets to page 1."
      },
      "EnrichResponse": {
        "type": "object",
        "properties": {
          "enrichmentId": {
            "type": "string",
            "nullable": true
          },
          "person": {
            "allOf": [
              {
                "$ref": "#/components/schemas/Person"
              },
              {
                "nullable": true
              }
            ]
          }
        },
        "required": [
          "enrichmentId",
          "person"
        ]
      },
      "EnrichRequest": {
        "type": "object",
        "properties": {
          "apolloPersonId": {
            "type": "string",
            "minLength": 1
          },
          "runId": {
            "type": "string",
            "description": "Runs-service parent run ID. Required — enrichment record is stored and 1 apollo-enrichment-credit is tracked.",
            "example": "run-abc-123"
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          },
          "workflowName": {
            "type": "string",
            "description": "Workflow name for run tracking in runs-service.",
            "example": "fetch-lead"
          }
        },
        "required": [
          "apolloPersonId",
          "runId",
          "appId",
          "brandId",
          "campaignId"
        ]
      },
      "MatchResponse": {
        "type": "object",
        "properties": {
          "enrichmentId": {
            "type": "string",
            "nullable": true
          },
          "person": {
            "allOf": [
              {
                "$ref": "#/components/schemas/Person"
              },
              {
                "nullable": true
              }
            ]
          },
          "cached": {
            "type": "boolean",
            "description": "True if the result was served from cache (no Apollo API call)."
          }
        },
        "required": [
          "enrichmentId",
          "person",
          "cached"
        ]
      },
      "MatchRequest": {
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "minLength": 1
          },
          "lastName": {
            "type": "string",
            "minLength": 1
          },
          "organizationDomain": {
            "type": "string",
            "minLength": 1
          },
          "runId": {
            "type": "string",
            "description": "Runs-service parent run ID. Required — match record is stored and costs tracked.",
            "example": "run-abc-123"
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          },
          "workflowName": {
            "type": "string",
            "description": "Workflow name for run tracking in runs-service.",
            "example": "fetch-lead"
          }
        },
        "required": [
          "firstName",
          "lastName",
          "organizationDomain",
          "runId",
          "appId",
          "brandId",
          "campaignId"
        ]
      },
      "MatchBulkResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MatchBulkResult"
            },
            "description": "Results in the same order as the input items array."
          }
        },
        "required": [
          "results"
        ]
      },
      "MatchBulkResult": {
        "type": "object",
        "properties": {
          "enrichmentId": {
            "type": "string",
            "nullable": true
          },
          "person": {
            "allOf": [
              {
                "$ref": "#/components/schemas/Person"
              },
              {
                "nullable": true
              }
            ]
          },
          "cached": {
            "type": "boolean"
          }
        },
        "required": [
          "enrichmentId",
          "person",
          "cached"
        ]
      },
      "MatchBulkRequest": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MatchBulkItem"
            },
            "minItems": 1,
            "maxItems": 10
          },
          "runId": {
            "type": "string",
            "description": "Runs-service parent run ID. A single run covers the entire batch.",
            "example": "run-abc-123"
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          },
          "workflowName": {
            "type": "string",
            "description": "Workflow name for run tracking in runs-service.",
            "example": "fetch-lead"
          }
        },
        "required": [
          "items",
          "runId",
          "appId",
          "brandId",
          "campaignId"
        ]
      },
      "MatchBulkItem": {
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "minLength": 1
          },
          "lastName": {
            "type": "string",
            "minLength": 1
          },
          "organizationDomain": {
            "type": "string",
            "minLength": 1
          }
        },
        "required": [
          "firstName",
          "lastName",
          "organizationDomain"
        ]
      },
      "SearchesResponse": {
        "type": "object",
        "properties": {
          "searches": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SearchRecord"
            }
          }
        },
        "required": [
          "searches"
        ]
      },
      "SearchRecord": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "orgId": {
            "type": "string",
            "format": "uuid"
          },
          "runId": {
            "type": "string"
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          },
          "requestParams": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            }
          },
          "peopleCount": {
            "type": "number"
          },
          "totalEntries": {
            "type": "number"
          },
          "responseRaw": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            }
          },
          "createdAt": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "orgId",
          "runId",
          "appId",
          "brandId",
          "campaignId",
          "requestParams",
          "peopleCount",
          "totalEntries",
          "responseRaw",
          "createdAt"
        ]
      },
      "EnrichmentsResponse": {
        "type": "object",
        "properties": {
          "enrichments": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EnrichmentRecord"
            }
          }
        },
        "required": [
          "enrichments"
        ]
      },
      "EnrichmentRecord": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "orgId": {
            "type": "string",
            "format": "uuid"
          },
          "runId": {
            "type": "string"
          },
          "searchId": {
            "type": "string",
            "nullable": true,
            "format": "uuid"
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          },
          "apolloPersonId": {
            "type": "string"
          },
          "firstName": {
            "type": "string",
            "nullable": true
          },
          "lastName": {
            "type": "string",
            "nullable": true
          },
          "email": {
            "type": "string",
            "nullable": true
          },
          "emailStatus": {
            "type": "string",
            "nullable": true
          },
          "title": {
            "type": "string",
            "nullable": true
          },
          "linkedinUrl": {
            "type": "string",
            "nullable": true
          },
          "photoUrl": {
            "type": "string",
            "nullable": true
          },
          "headline": {
            "type": "string",
            "nullable": true
          },
          "city": {
            "type": "string",
            "nullable": true
          },
          "state": {
            "type": "string",
            "nullable": true
          },
          "country": {
            "type": "string",
            "nullable": true
          },
          "seniority": {
            "type": "string",
            "nullable": true
          },
          "departments": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "subdepartments": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "functions": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "twitterUrl": {
            "type": "string",
            "nullable": true
          },
          "githubUrl": {
            "type": "string",
            "nullable": true
          },
          "facebookUrl": {
            "type": "string",
            "nullable": true
          },
          "employmentHistory": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "organizationName": {
                  "type": "string"
                },
                "startDate": {
                  "type": "string"
                },
                "endDate": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                },
                "current": {
                  "type": "boolean"
                }
              }
            }
          },
          "organizationName": {
            "type": "string",
            "nullable": true
          },
          "organizationDomain": {
            "type": "string",
            "nullable": true
          },
          "organizationIndustry": {
            "type": "string",
            "nullable": true
          },
          "organizationSize": {
            "type": "string",
            "nullable": true
          },
          "organizationRevenueUsd": {
            "type": "string",
            "nullable": true
          },
          "organizationWebsiteUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationLogoUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationShortDescription": {
            "type": "string",
            "nullable": true
          },
          "organizationSeoDescription": {
            "type": "string",
            "nullable": true
          },
          "organizationLinkedinUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationTwitterUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationFacebookUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationBlogUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationCrunchbaseUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationAngellistUrl": {
            "type": "string",
            "nullable": true
          },
          "organizationFoundedYear": {
            "type": "number",
            "nullable": true
          },
          "organizationPrimaryPhone": {
            "type": "string",
            "nullable": true
          },
          "organizationPubliclyTradedSymbol": {
            "type": "string",
            "nullable": true
          },
          "organizationPubliclyTradedExchange": {
            "type": "string",
            "nullable": true
          },
          "organizationAnnualRevenuePrinted": {
            "type": "string",
            "nullable": true
          },
          "organizationTotalFunding": {
            "type": "string",
            "nullable": true
          },
          "organizationTotalFundingPrinted": {
            "type": "string",
            "nullable": true
          },
          "organizationLatestFundingRoundDate": {
            "type": "string",
            "nullable": true
          },
          "organizationLatestFundingStage": {
            "type": "string",
            "nullable": true
          },
          "organizationFundingEvents": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "date": {
                  "type": "string"
                },
                "type": {
                  "type": "string"
                },
                "investors": {
                  "type": "string"
                },
                "amount": {
                  "type": "number"
                },
                "currency": {
                  "type": "string"
                }
              }
            }
          },
          "organizationCity": {
            "type": "string",
            "nullable": true
          },
          "organizationState": {
            "type": "string",
            "nullable": true
          },
          "organizationCountry": {
            "type": "string",
            "nullable": true
          },
          "organizationStreetAddress": {
            "type": "string",
            "nullable": true
          },
          "organizationPostalCode": {
            "type": "string",
            "nullable": true
          },
          "organizationTechnologyNames": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationCurrentTechnologies": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "object",
              "properties": {
                "uid": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "category": {
                  "type": "string"
                }
              }
            }
          },
          "organizationKeywords": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationIndustries": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationSecondaryIndustries": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            }
          },
          "organizationNumSuborganizations": {
            "type": "number",
            "nullable": true
          },
          "organizationRetailLocationCount": {
            "type": "number",
            "nullable": true
          },
          "organizationAlexaRanking": {
            "type": "number",
            "nullable": true
          },
          "responseRaw": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            }
          },
          "enrichmentRunId": {
            "type": "string",
            "nullable": true
          },
          "createdAt": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "orgId",
          "runId",
          "appId",
          "brandId",
          "campaignId",
          "apolloPersonId",
          "responseRaw",
          "createdAt"
        ]
      },
      "StatsResponse": {
        "type": "object",
        "properties": {
          "stats": {
            "$ref": "#/components/schemas/Stats"
          }
        },
        "required": [
          "stats"
        ]
      },
      "Stats": {
        "type": "object",
        "properties": {
          "enrichedLeadsCount": {
            "type": "integer"
          },
          "searchCount": {
            "type": "integer"
          },
          "fetchedPeopleCount": {
            "type": "integer"
          },
          "totalMatchingPeople": {
            "type": "integer"
          }
        },
        "required": [
          "enrichedLeadsCount",
          "searchCount",
          "fetchedPeopleCount",
          "totalMatchingPeople"
        ]
      },
      "StatsRequest": {
        "type": "object",
        "properties": {
          "runIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "appId": {
            "type": "string"
          },
          "brandId": {
            "type": "string"
          },
          "campaignId": {
            "type": "string"
          }
        }
      },
      "IndustriesResponse": {
        "type": "object",
        "properties": {
          "industries": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Industry"
            }
          }
        },
        "required": [
          "industries"
        ]
      },
      "Industry": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          }
        },
        "required": [
          "name"
        ]
      },
      "EmployeeRangesResponse": {
        "type": "object",
        "properties": {
          "ranges": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EmployeeRange"
            }
          }
        },
        "required": [
          "ranges"
        ]
      },
      "EmployeeRange": {
        "type": "object",
        "properties": {
          "label": {
            "type": "string"
          },
          "value": {
            "type": "string"
          }
        },
        "required": [
          "label",
          "value"
        ]
      },
      "SearchParamsResponse": {
        "type": "object",
        "properties": {
          "searchParams": {
            "allOf": [
              {
                "$ref": "#/components/schemas/SearchFilters"
              },
              {
                "description": "Validated Apollo search filters that returned results."
              }
            ]
          },
          "totalResults": {
            "type": "number",
            "description": "Apollo total_entries for the final search params."
          },
          "attempts": {
            "type": "number",
            "description": "Number of LLM iterations (1 = first try worked)."
          },
          "attemptHistory": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SearchParamsAttempt"
            },
            "description": "Full history of all attempts for debugging."
          }
        },
        "required": [
          "searchParams",
          "totalResults",
          "attempts",
          "attemptHistory"
        ]
      },
      "SearchParamsAttempt": {
        "type": "object",
        "properties": {
          "searchParams": {
            "allOf": [
              {
                "$ref": "#/components/schemas/SearchFilters"
              },
              {
                "description": "Apollo search filters. All filters are combined using AND. Start broad and narrow down to avoid empty results."
              }
            ]
          },
          "totalResults": {
            "type": "number"
          }
        },
        "required": [
          "searchParams",
          "totalResults"
        ]
      },
      "SearchParamsRequest": {
        "type": "object",
        "properties": {
          "context": {
            "type": "string",
            "minLength": 1,
            "description": "Unstructured context about the company — website content, target audience description, ICP notes, or any combination. The LLM extracts what it needs.",
            "example": "We are a B2B SaaS company selling developer tools. Target audience: engineering leaders at mid-size tech companies in the US."
          },
          "keySource": {
            "type": "string",
            "enum": [
              "byok",
              "app"
            ],
            "description": "Where to fetch API keys (Apollo + Anthropic). \"byok\" = user's own keys from key-service, \"app\" = platform app keys.",
            "example": "app"
          },
          "runId": {
            "type": "string",
            "description": "Runs-service parent run ID for cost tracking.",
            "example": "run-abc-123"
          },
          "appId": {
            "type": "string",
            "example": "my-app"
          },
          "brandId": {
            "type": "string",
            "example": "brand-1"
          },
          "campaignId": {
            "type": "string",
            "example": "campaign-1"
          },
          "workflowName": {
            "type": "string",
            "description": "Workflow name for run tracking in runs-service.",
            "example": "fetch-lead"
          }
        },
        "required": [
          "context",
          "keySource",
          "runId",
          "appId",
          "brandId",
          "campaignId"
        ]
      },
      "ValidateResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ValidationResult"
            }
          }
        },
        "required": [
          "results"
        ]
      },
      "ValidationResult": {
        "type": "object",
        "properties": {
          "index": {
            "type": "number"
          },
          "valid": {
            "type": "boolean"
          },
          "endpoint": {
            "type": "string",
            "enum": [
              "search",
              "enrich",
              "bulk-enrich"
            ]
          },
          "errors": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            }
          }
        },
        "required": [
          "index",
          "valid",
          "endpoint",
          "errors"
        ]
      },
      "ValidationError": {
        "type": "object",
        "properties": {
          "field": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "value": {
            "nullable": true
          }
        },
        "required": [
          "field",
          "message"
        ]
      },
      "ValidateRequest": {
        "type": "object",
        "properties": {
          "endpoint": {
            "type": "string",
            "enum": [
              "search",
              "enrich",
              "bulk-enrich"
            ]
          },
          "items": {
            "type": "array",
            "items": {
              "nullable": true
            },
            "minItems": 1
          }
        },
        "required": [
          "endpoint",
          "items"
        ]
      }
    },
    "parameters": {
      "OrgId": {
        "schema": {
          "$ref": "#/components/schemas/OrgId"
        },
        "required": true,
        "description": "Organization ID",
        "name": "x-org-id",
        "in": "header"
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health/debug": {
      "get": {
        "summary": "Debug health check with dependency status",
        "responses": {
          "200": {
            "description": "Debug health information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthDebugResponse"
                }
              }
            }
          }
        }
      }
    },
    "/search": {
      "post": {
        "summary": "Search for people via Apollo",
        "description": "Search Apollo's people database. If runId is provided, results are stored in DB and costs tracked via runs-service.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/search/next": {
      "post": {
        "summary": "Get next page of search results for a campaign",
        "description": "Server-managed pagination. First call with searchParams creates a cursor at page 1. Subsequent calls (with or without searchParams) return the next page. Each call returns one page of 25 people and advances the cursor. When done=true, all pages are exhausted. If searchParams differ from the stored cursor, pagination resets to page 1.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchNextRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Next batch of people",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchNextResponse"
                }
              }
            }
          },
          "400": {
            "description": "No cursor found (call with searchParams first) or validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/enrich": {
      "post": {
        "summary": "Enrich a person via Apollo to reveal their email",
        "description": "Enrich a single person by Apollo person ID. Uses 12-month cache. If runId is provided, stores record and tracks costs.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EnrichRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Enrichment result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnrichResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/match": {
      "post": {
        "summary": "Match a person by name and organization domain via Apollo",
        "description": "Match a single person by firstName + lastName + organizationDomain. Uses 12-month cache. Costs tracked as apollo-person-match-credit (only charged when email is found).",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MatchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Match result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MatchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/match/bulk": {
      "post": {
        "summary": "Bulk match people by name and organization domain via Apollo",
        "description": "Match up to 10 people by firstName + lastName + organizationDomain. Each item is cached independently. A single run covers the whole batch; costs tracked per item (apollo-person-match-credit, only when email found).",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MatchBulkRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Bulk match results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MatchBulkResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/searches/{runId}": {
      "get": {
        "summary": "Get all searches for a run",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "runId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "List of search records",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchesResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/enrichments/{runId}": {
      "get": {
        "summary": "Get all enrichments for a run",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "runId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "List of enrichment records",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnrichmentsResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/stats": {
      "post": {
        "summary": "Get aggregated stats",
        "description": "Returns aggregated search and enrichment stats. All body filters are optional; orgId is always applied from auth.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StatsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Aggregated stats",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatsResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/reference/industries": {
      "get": {
        "summary": "Get Apollo industries list",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "List of industries",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndustriesResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/reference/employee-ranges": {
      "get": {
        "summary": "Get employee range options",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "List of employee ranges",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EmployeeRangesResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/search/params": {
      "post": {
        "summary": "Generate Apollo search parameters from context using LLM",
        "description": "Takes unstructured context (website content, target audience, etc.) and uses Claude to generate Apollo search filters. Validates against Apollo — if 0 results, retries with broadened filters (max 10 attempts). Returns validated search params guaranteed to produce results, or the best-effort params after 10 attempts.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchParamsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Generated and validated search parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchParamsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/validate": {
      "post": {
        "summary": "Validate a batch of items against Apollo schemas",
        "description": "Validates items against the specified endpoint schema (search, enrich, or bulk-enrich).",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "x-org-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  }
}